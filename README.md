# Adding new polls

Bueno, entonces, ahora ya vimos que este formulario funciona y que cuando lo enviamos, obtenemos este objeto fields que tiene la pregunta, la respuesta A y la respuesta B. En el futuro, lo que me gustaría hacer es tener un array de datos registrado dentro del componente App, que sería un array de objetos. Cada objeto representaría una encuesta, con la pregunta, las respuestas A y B, pero también tendría algunas otras cosas: una propiedad para los votos de la respuesta A, para seguir la cantidad de votos de A, y otra para los votos de la respuesta B. Además, tendría un campo ID, que sería único para cada encuesta.

Entonces, vamos a ir al formulario de creación de encuesta y lo primero que vamos a hacer es componer un nuevo objeto de encuesta abajo. Después, vamos a emitir un evento personalizado, pasando ese objeto de encuesta a App.velts, y luego podemos agregar ese nuevo objeto de encuesta a un array de encuestas.

Primero, vamos a importar en la parte superior el create event dispatcher (creador de eventos), así que importamos createEventDispatcher de svelte. Y después necesitamos crear la función para despachar el evento. Lo vamos a hacer así: let dispatch = createEventDispatcher();. Ahora ya tenemos nuestra función dispatch lista para usar, y la vamos a usar más abajo, pero primero vamos a componer ese objeto de encuesta.

Ahora digo let poll = {}, y dentro de este objeto, primero quiero esparcir todas las propiedades de fields (recordemos que es el objeto que tiene la pregunta, la respuesta A y la respuesta B). Entonces, estamos añadiendo la pregunta, la respuesta A y la respuesta B que el usuario ingresa en este nuevo objeto, pero también necesitamos las propiedades adicionales. Así que votesA = 0 (para los votos de A) y votesB = 0 (para los votos de B) al principio. También necesitamos un ID aleatorio, así que hago ID = Math.random(), aunque no es la mejor manera de obtener un número aleatorio (en el futuro podríamos usar una librería externa para hacer esto de forma más robusta), pero por ahora está bien.

Entonces, ahora tenemos este objeto de encuesta. Lo que queremos es agregarlo a un array de datos dentro de nuestro App.velts, así que necesitamos emitir un evento personalizado en lugar de simplemente hacer un console.log. Vamos a decir: dispatch('add', poll);, porque estamos agregando una nueva encuesta, y el dato que queremos enviar con ese evento es la encuesta que acabamos de crear.

Ahora podemos escuchar ese evento dentro de App.velts y lo hacemos en el formulario de creación de encuesta, así que usamos on:add, y lo igualamos a una función, por ejemplo, handleAdd, así que decimos handleAdd, y ahora tenemos que crear esa función.

Antes de hacerlo, quiero crear algunos datos para las encuestas. Así que voy a copiar esto desde mi repo y pegarlo abajo de tabs. Lo que estoy haciendo es crear un array llamado polls, y dentro de ese array, al principio voy a poner un objeto de encuesta de prueba, solo para ver algo cuando carguemos la página. Más adelante, quizás empecemos con un array vacío y las encuestas solo van a aparecer cuando agreguemos datos a ese array. Pero por ahora, tenemos una encuesta de prueba que tiene un ID de 1, la pregunta "¿Python o JavaScript?", con "Python" como respuesta A y "JavaScript" como respuesta B. Los votos son 9 para A y 15 para B.

Ahora, necesito crear la función handleAdd. Entonces, voy a hacer const handleAdd = (e) => {}, y dentro de esa función, lo que hacemos es acceder al detalle del evento, así que vamos a decir: const poll = e.detail;. Ese es el objeto que enviamos con el evento. Después, vamos a actualizar el array polls, que es este array que tenemos acá. Vamos a crear un nuevo array y dentro de ese array vamos a poner la nueva encuesta (poll) y luego vamos a esparcir los polls actuales para que todo lo que ya teníamos en polls quede dentro del nuevo array.

Después de eso, voy a agregar un console.log para ver cómo se actualiza el array de encuestas cada vez que agregamos una. Así que guardamos esto, vamos a agregar una nueva encuesta y probamos: "¿Te gusta el Marmite?", con "Sí" y "No" como respuestas. Al agregar la encuesta, podemos ver que el array de polls ahora tiene dos elementos: el que acabamos de agregar y el de prueba que teníamos al principio. Vamos a agregar otra encuesta, y podemos ver cómo el array ahora tiene tres elementos.

Ahora, lo que quiero hacer también dentro de esta función es, una vez que hayamos enviado el formulario, volver automáticamente a la vista de encuestas. Para hacer esto, vamos a actualizar el valor de activeItem, porque recordemos que pasamos ese valor a los tabs y lo usamos para decidir qué contenido mostrar. Así que, cuando agreguemos una nueva encuesta, vamos a poner activeItem = 'currentPolls' para que volvamos a ver las encuestas actuales y no el formulario de creación.

Así que guardamos esto, probamos, agregamos una nueva encuesta, y después de agregarla, la vista vuelve a las encuestas actuales. Más adelante vamos a mostrar todas las encuestas aquí. Pero por ahora, eso es lo que queríamos demostrar.

Ahora vamos a crear un nuevo componente llamado PollList, que va a ser el encargado de recorrer el array de encuestas y mostrar una lista de todas las encuestas. Así que creamos el componente PollList, importamos este componente en el archivo de App, y lo renderizamos en el template.

En este componente, necesitamos aceptar una propiedad (prop) llamada polls, que será el array con todas las encuestas. Luego, vamos a hacer un each para recorrer ese array y mostrar las preguntas de cada encuesta. Usamos poll.id como clave para cada encuesta.

Finalmente, vamos a estilizar la lista de encuestas. Para eso, vamos a mostrar las encuestas en una grilla (grid), en lugar de en una lista vertical. Así, tendremos una encuesta a la izquierda, otra a la derecha, y después, una nueva fila. Lo hacemos con CSS Grid, configurando el grid-template-columns para que haya dos columnas (una para cada encuesta), con un espacio de 20px entre ellas.

Entonces, guardamos los cambios, probamos y vemos cómo las encuestas se muestran en esta grilla, de manera que si agregamos más encuestas, se van acomodando bien en la pantalla.

En el próximo video, vamos a profundizar un poco más en cómo mostrar detalles de cada encuesta, como los votos y las opciones, y lo vamos a hacer en un nuevo componente llamado PollDetails, que vamos a registrar dentro de App. ¡Eso será para la próxima!